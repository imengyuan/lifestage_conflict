---
title: "FC - pi plot"
author: "Meng"
date: "2023-06-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(rattle)
directory="/Users/yuanmeng/Library/CloudStorage/OneDrive-UniversityofToronto/Manuscripts/rumex_haploid_sel/pixy/"
```
## merge with pi data
```{r}
FC_pixy<- inner_join(DE_tissue,pixy,by=c("gene")) # 10819
write.table(FC_pixy, file = paste0(directory,"FC_pixy_innerjoin.txt"), row.names = FALSE, quote = FALSE)
```


## prepare gene sets
separate to p-biased and l-biased
then 4 quantiles within each category
DE gene cutoffs: padj<0.1 & baseMean >= 1
logFC>0: pollen biased, logFC <-: leaf biased
```{r}
pollen_bias <- FC_pixy %>% filter(log2FoldChange>0) # 3895
leaf_bias <- FC_pixy %>% filter(log2FoldChange<0) # 6924

bin<-binning(pollen_bias$log2FoldChange, bins=4, method="quantile",
                     labels=NULL, ordered=TRUE, weights=NULL)
plot(bin)

bin<-binning(leaf_bias$log2FoldChange, bins=4, method="quantile",
                     labels=NULL, ordered=TRUE, weights=NULL)
plot(bin)
```

break and tags for FC
```{r}
breaks <- c(0,0.00102,0.117,0.224,0.4,0.802,1.82,5.21,27.8)
# specify interval/bin labels
tags <- c("[0-0.239)","[0.239-0.486)", "[0.486-0.705)", "[0.705-0.95)", "[0.95-1.25)", "[1.25-1.8)","[1.8-3.7)", "[3.7-inf)")

# bucketing values into bins
group_tags <- cut(FC_pixy$log2FoldChange, 
                  breaks=breaks, 
                  include.lowest=TRUE, 
                  right=FALSE, 
                  labels=tags)
# inspect bins
summary(group_tags)

ratio_groups <- factor(group_tags, 
                           levels = tags,
                           ordered = TRUE)
```
pollen
1.18]
2.68]
5.63]
26.2]

leaf
-3.06]
-2.22]
-1.39]
-0.101]

## plot
```{r}
v <- FC_pixy %>% select(log2FoldChange,avg_pi) 
vgroup <- as_tibble(v) %>% 
  mutate(tag = case_when(
    log2FoldChange > 0 & log2FoldChange <= 1.18 ~ tags[5],
    log2FoldChange > 1.18 & log2FoldChange <= 2.68 ~ tags[6],
    log2FoldChange > 2.68 & log2FoldChange <= 5.63 ~ tags[7],
    log2FoldChange > 5.63   ~ tags[8],
    
    log2FoldChange <= -3.06 ~ tags[1],
    log2FoldChange > -3.06 & log2FoldChange <= -2.22 ~ tags[2],
    log2FoldChange > -2.22 & log2FoldChange <= -1.39 ~ tags[3],
    log2FoldChange > -1.39 & log2FoldChange < 0 ~ tags[4]

    ))
summary(vgroup)

vgroup$tag <- factor(vgroup$tag,
                       levels = tags,
                       ordered = FALSE)

ggplot(data = vgroup, mapping = aes(x=tag,y=avg_pi)) + 
    geom_jitter(color="#1F78B4",alpha=0.2) +
    geom_boxplot(fill="#1F78B4",color="black",alpha=0.3) + 
    labs(x='g_s_ratio') +
    guides(color=FALSE) + ylim(0,0.06)+
    theme_classic() + theme(text = element_text(size = 18))

```






